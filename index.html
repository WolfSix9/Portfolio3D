<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portfolio 3D Model Viewer</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background-color: #000;
      }
      #loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #000;
        color: #fff;
        font-family: sans-serif;
        font-size: 22px;
      }
    </style>
  </head>

  <body>
    <div id="loading">กำลังโหลดโมเดล...</div>

    <!-- โหลดไลบรารี -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/MTLLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/RGBELoader.js"></script>

    <script>
      // -------------------------------
      // สร้าง Renderer
      // -------------------------------
      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.shadowMap.enabled = true;
      document.body.appendChild(renderer.domElement);

      // -------------------------------
      // สร้าง Scene
      // -------------------------------
      const scene = new THREE.Scene();

      // -------------------------------
      // สร้าง Camera
      // -------------------------------
      const camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      camera.position.set(0, 2, 8);
      const controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;

      // -------------------------------
      // แสง
      // -------------------------------
      scene.add(new THREE.AmbientLight(0xffffff, 1.3));
      const dirLight = new THREE.DirectionalLight(0xffffff, 1.8);
      dirLight.position.set(10, 15, 10);
      dirLight.castShadow = true;
      scene.add(dirLight);

      // -------------------------------
      // พื้น (Ground)
      // -------------------------------
      const groundTex = new THREE.TextureLoader().load(
        "https://film2147.github.io/modelwork3/asphalt-road-texture-dark-gray-color_1017-20231.jpg"
      );
      groundTex.wrapS = THREE.RepeatWrapping;
      groundTex.wrapT = THREE.RepeatWrapping;
      groundTex.repeat.set(6, 6);

      const groundMat = new THREE.MeshStandardMaterial({
        map: groundTex,
        roughness: 0.9,
        metalness: 0.1,
      });

      const ground = new THREE.Mesh(
        new THREE.PlaneGeometry(100, 100),
        groundMat
      );
      ground.rotation.x = -Math.PI / 2;
      ground.receiveShadow = true;
      scene.add(ground);

      // -------------------------------
      // พื้นหลัง HDRI
      // -------------------------------
      const rgbeLoader = new THREE.RGBELoader();
      rgbeLoader.setDataType(THREE.UnsignedByteType);
      rgbeLoader.load(
        "https://dl.polyhaven.org/file/ph-assets/HDRIs/hdr/1k/qwantani_dusk_1_puresky_1k.hdr",
        function (texture) {
          texture.mapping = THREE.EquirectangularReflectionMapping;
          scene.background = texture;
          scene.environment = texture;
        }
      );

      // -------------------------------
      // โหลดโมเดล OBJ + MTL
      // -------------------------------
      const mtlLoader = new THREE.MTLLoader();
      mtlLoader.setPath("Model/");
      mtlLoader.load("home.mtl", (materials) => {
        materials.preload();

        const objLoader = new THREE.OBJLoader();
        objLoader.setMaterials(materials);
        objLoader.setPath("Model/");
        objLoader.load(
          "home.obj",
          (object) => {
            object.traverse((child) => {
              if (child.isMesh) {
                child.castShadow = true;
                child.receiveShadow = true;
              }
            });
            object.scale.set(10, 10, 10);
            object.position.set(0, 1, 0);
            scene.add(object);
            document.getElementById("loading").style.display = "none";
          },
          (xhr) => {
            document.getElementById("loading").innerText =
              "กำลังโหลด... " + Math.round((xhr.loaded / xhr.total) * 100) + "%";
          },
          (error) => {
            console.error("❌ โหลดโมเดลไม่สำเร็จ:", error);
            document.getElementById("loading").innerText =
              "เกิดข้อผิดพลาดในการโหลดโมเดล!";
          }
        );
      });

      // -------------------------------
      // Render Loop
      // -------------------------------
      function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
      }
      animate();

      // -------------------------------
      // ปรับขนาดเมื่อเปลี่ยนหน้าต่าง
      // -------------------------------
      window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    </script>
  </body>
</html>
